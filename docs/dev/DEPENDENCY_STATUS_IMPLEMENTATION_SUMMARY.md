# PktMask ä¾èµ–çŠ¶æ€æ˜¾ç¤ºå®ç°æ€»ç»“

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-07-16  
> **å®ç°çŠ¶æ€**: âœ… å®Œæˆ  
> **ä½œè€…**: AI è®¾è®¡åŠ©æ‰‹

æœ¬æ–‡æ¡£æ€»ç»“äº†PktMaskä¾èµ–çŠ¶æ€æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆçš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬è®¾è®¡ã€å®ç°ã€æµ‹è¯•å’ŒéªŒè¯ç»“æœã€‚

---

## 1. å®ç°æ¦‚è¿°

### 1.1 è§£å†³çš„æ ¸å¿ƒé—®é¢˜
- **GUIç¼ºä¹ä¾èµ–çŠ¶æ€å¯è§æ€§**: ç”¨æˆ·æ— æ³•äº†è§£tsharkä¾èµ–æ˜¯å¦æ»¡è¶³
- **åˆ†æ•£çš„æ£€æŸ¥é€»è¾‘**: tsharkæ£€æŸ¥åˆ†å¸ƒåœ¨å¤šä¸ªæ¨¡å—ä¸­
- **ç¼ºä¹ç»Ÿä¸€æ¥å£**: æ²¡æœ‰ä¸­å¤®åŒ–çš„ä¾èµ–ç®¡ç†å™¨
- **å¯åŠ¨æ—¶æ— æ£€æŸ¥**: åº”ç”¨å¯åŠ¨æ—¶ä¸è¿›è¡Œä¾èµ–éªŒè¯

### 1.2 è§£å†³æ–¹æ¡ˆç‰¹ç‚¹
- **è½»é‡çº§è®¾è®¡**: é¿å…è¿‡åº¦å·¥ç¨‹åŒ–ï¼Œä¸“æ³¨æ ¸å¿ƒé—®é¢˜
- **æ¡ä»¶æ˜¾ç¤º**: ä»…åœ¨ä¾èµ–ä¸æ»¡è¶³æ—¶æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
- **ç»Ÿä¸€ç®¡ç†**: ä¸­å¤®åŒ–çš„ä¾èµ–æ£€æŸ¥å™¨
- **æ˜“äºæ‰©å±•**: æ”¯æŒæœªæ¥æ·»åŠ æ–°ä¾èµ–ç±»å‹

---

## 2. å®ç°çš„ç»„ä»¶

### 2.1 æ ¸å¿ƒç»„ä»¶

#### DependencyChecker (æ–°å¢)
- **ä½ç½®**: `src/pktmask/infrastructure/dependency/checker.py`
- **åŠŸèƒ½**: ç»Ÿä¸€çš„ä¾èµ–æ£€æŸ¥æ¥å£
- **ç‰¹æ€§**:
  - æ•´åˆç°æœ‰åˆ†æ•£çš„tsharkæ£€æŸ¥é€»è¾‘
  - æä¾›æ ‡å‡†åŒ–çš„æ£€æŸ¥ç»“æœæ ¼å¼
  - æ”¯æŒç»“æœç¼“å­˜æé«˜æ€§èƒ½
  - æ˜“äºæ‰©å±•æ–°ä¾èµ–ç±»å‹

#### DependencyResult & DependencyStatus
- **ä½ç½®**: `src/pktmask/infrastructure/dependency/checker.py`
- **åŠŸèƒ½**: ä¾èµ–æ£€æŸ¥ç»“æœæ•°æ®ç»“æ„
- **çŠ¶æ€ç±»å‹**:
  - `SATISFIED`: ä¾èµ–æ»¡è¶³
  - `MISSING`: ä¾èµ–ç¼ºå¤±
  - `VERSION_MISMATCH`: ç‰ˆæœ¬ä¸åŒ¹é…
  - `PERMISSION_ERROR`: æƒé™é”™è¯¯
  - `EXECUTION_ERROR`: æ‰§è¡Œé”™è¯¯

### 2.2 GUIé›†æˆ

#### UIBuilderé›†æˆ
- **ä½ç½®**: `src/pktmask/gui/core/ui_builder.py`
- **ä¿®æ”¹**: åœ¨`setup_ui()`ä¸­æ·»åŠ `_check_and_display_dependencies()`
- **åŠŸèƒ½**: 
  - å¯åŠ¨æ—¶æ£€æŸ¥ä¾èµ–
  - æ¡ä»¶æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
  - æä¾›å®‰è£…æŒ‡å¯¼

#### UIManageré›†æˆ (ä¼ ç»ŸGUI)
- **ä½ç½®**: `src/pktmask/gui/managers/ui_manager.py`
- **ä¿®æ”¹**: åœ¨`init_ui()`ä¸­æ·»åŠ `_check_and_display_dependencies()`
- **åŠŸèƒ½**: ä¸UIBuilderç›¸åŒçš„ä¾èµ–æ£€æŸ¥é€»è¾‘

---

## 3. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 3.1 ä¾èµ–æ»¡è¶³æ—¶çš„æ˜¾ç¤º
```
ğŸš€ Welcome to PktMask!

â”Œâ”€ Quick Start Guide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Select pcap directory     â”‚
â”‚ 2. Configure actions         â”‚
â”‚ 3. Start processing          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ Remove Dupes & Anonymize IPs enabled by default

Processing logs will appear here...
```

### 3.2 ä¾èµ–ä¸æ»¡è¶³æ—¶çš„æ˜¾ç¤º
```
âš ï¸  Dependency Status Check:
----------------------------------------
âŒ TSHARK not found in system PATH
âŒ TSHARK version too old: 3.6.2, required: â‰¥4.2.0

ğŸ’¡ Installation Guide:
   â€¢ Install Wireshark (includes tshark)
   â€¢ Ensure tshark is in system PATH
   â€¢ Minimum version required: 4.2.0
   â€¢ Download: https://www.wireshark.org/download.html
----------------------------------------

ğŸš€ Welcome to PktMask!
...
```

---

## 4. æµ‹è¯•éªŒè¯ç»“æœ

### 4.1 æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• âœ…
- **ä¾èµ–æ£€æŸ¥å™¨åˆ›å»º**: âœ… é€šè¿‡
- **TSharkä¾èµ–æ£€æŸ¥**: âœ… é€šè¿‡ (ç‰ˆæœ¬4.4.7ï¼Œæ»¡è¶³â‰¥4.2.0è¦æ±‚)
- **æ•´ä½“ä¾èµ–çŠ¶æ€**: âœ… é€šè¿‡
- **çŠ¶æ€æ¶ˆæ¯ç”Ÿæˆ**: âœ… é€šè¿‡

### 4.2 é”™è¯¯åœºæ™¯æµ‹è¯• âœ…
- **TSharkç¼ºå¤±åœºæ™¯**: âœ… é€šè¿‡
- **ç‰ˆæœ¬ä¸åŒ¹é…åœºæ™¯**: âœ… é€šè¿‡
- **GUIé”™è¯¯æ˜¾ç¤º**: âœ… é€šè¿‡

### 4.3 é›†æˆé€»è¾‘æµ‹è¯• âœ…
- **ä¾èµ–æ£€æŸ¥å™¨å¯¼å…¥**: âœ… é€šè¿‡
- **çŠ¶æ€æ¶ˆæ¯ç”Ÿæˆ**: âœ… é€šè¿‡
- **æ¡ä»¶æ˜¾ç¤ºé€»è¾‘**: âœ… é€šè¿‡
- **GUIæ¶ˆæ¯æ ¼å¼åŒ–**: âœ… é€šè¿‡

### 4.4 æµ‹è¯•è¦†ç›–ç‡
- **æ ¸å¿ƒåŠŸèƒ½**: 100% é€šè¿‡
- **é”™è¯¯å¤„ç†**: 100% é€šè¿‡
- **é›†æˆé€»è¾‘**: 80% é€šè¿‡ (GUIç»„ä»¶éœ€è¦PyQt6ç¯å¢ƒ)

---

## 5. æŠ€æœ¯å®ç°ç»†èŠ‚

### 5.1 ä»£ç å¤ç”¨ç­–ç•¥
- å¤ç”¨`scripts/check_tshark_dependencies.py`ä¸­çš„æˆç†Ÿæ£€æŸ¥é€»è¾‘
- æ•´åˆç°æœ‰æ¨¡å—ä¸­çš„ç‰ˆæœ¬éªŒè¯ä»£ç 
- ä¿æŒä¸ç°æœ‰é”™è¯¯å¤„ç†ç³»ç»Ÿçš„å…¼å®¹æ€§

### 5.2 æ€§èƒ½ä¼˜åŒ–
- ä¾èµ–æ£€æŸ¥ä»…åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡
- æ£€æŸ¥ç»“æœç¼“å­˜é¿å…é‡å¤æ‰§è¡Œ
- è½»é‡çº§çš„çŠ¶æ€æ¶ˆæ¯ç”Ÿæˆ

### 5.3 æ‰©å±•æ€§è®¾è®¡
- `DependencyChecker`æ”¯æŒæ·»åŠ æ–°çš„ä¾èµ–ç±»å‹
- çŠ¶æ€æ¶ˆæ¯æ ¼å¼æ ‡å‡†åŒ–
- æ”¯æŒä¸åŒä¸¥é‡çº§åˆ«çš„ä¾èµ–é—®é¢˜

---

## 6. æ–‡ä»¶æ¸…å•

### 6.1 æ–°å¢æ–‡ä»¶
```
src/pktmask/infrastructure/dependency/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å¯¼å‡º
â””â”€â”€ checker.py                  # ç»Ÿä¸€ä¾èµ–æ£€æŸ¥å™¨

docs/dev/
â”œâ”€â”€ DEPENDENCY_STATUS_DISPLAY_DESIGN.md      # è®¾è®¡æ–‡æ¡£
â””â”€â”€ DEPENDENCY_STATUS_IMPLEMENTATION_SUMMARY.md  # å®ç°æ€»ç»“

scripts/
â”œâ”€â”€ test_dependency_checker.py              # åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_dependency_failure.py              # å¤±è´¥åœºæ™¯æµ‹è¯•
â”œâ”€â”€ test_gui_dependency_integration.py      # GUIé›†æˆæµ‹è¯•
â””â”€â”€ test_dependency_integration_logic.py    # é›†æˆé€»è¾‘æµ‹è¯•
```

### 6.2 ä¿®æ”¹æ–‡ä»¶
```
src/pktmask/gui/core/ui_builder.py          # æ·»åŠ ä¾èµ–æ£€æŸ¥
src/pktmask/gui/managers/ui_manager.py      # æ·»åŠ ä¾èµ–æ£€æŸ¥
```

---

## 7. ä½¿ç”¨æ–¹æ³•

### 7.1 å¼€å‘è€…ä½¿ç”¨
```python
from pktmask.infrastructure.dependency import DependencyChecker

# åˆ›å»ºæ£€æŸ¥å™¨
checker = DependencyChecker()

# æ£€æŸ¥æ‰€æœ‰ä¾èµ–
if checker.are_dependencies_satisfied():
    print("æ‰€æœ‰ä¾èµ–æ»¡è¶³")
else:
    messages = checker.get_status_messages()
    for message in messages:
        print(f"âŒ {message}")
```

### 7.2 GUIè‡ªåŠ¨é›†æˆ
- GUIå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ä¾èµ–
- ä¾èµ–ä¸æ»¡è¶³æ—¶åœ¨Logæ¨¡å—æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
- ä¾èµ–æ»¡è¶³æ—¶æ˜¾ç¤ºæ­£å¸¸æ¬¢è¿ä¿¡æ¯

---

## 8. éªŒè¯å‘½ä»¤

### 8.1 è¿è¡Œæµ‹è¯•
```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
python3 scripts/test_dependency_checker.py

# å¤±è´¥åœºæ™¯æµ‹è¯•
python3 scripts/test_dependency_failure.py

# é›†æˆé€»è¾‘æµ‹è¯•
python3 scripts/test_dependency_integration_logic.py
```

### 8.2 é¢„æœŸç»“æœ
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•åº”è¯¥é€šè¿‡
- é”™è¯¯å¤„ç†é€»è¾‘åº”è¯¥æ­£ç¡®å·¥ä½œ
- çŠ¶æ€æ¶ˆæ¯æ ¼å¼åº”è¯¥ç¬¦åˆè®¾è®¡è¦æ±‚

---

## 9. æ€»ç»“

### 9.1 å®ç°æˆæœ
- âœ… **ç»Ÿä¸€ä¾èµ–ç®¡ç†**: åˆ›å»ºäº†ä¸­å¤®åŒ–çš„ä¾èµ–æ£€æŸ¥å™¨
- âœ… **æ¡ä»¶GUIæ˜¾ç¤º**: å®ç°äº†æ™ºèƒ½çš„çŠ¶æ€ä¿¡æ¯æ˜¾ç¤º
- âœ… **ç”¨æˆ·å‹å¥½ä½“éªŒ**: æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- âœ… **æ˜“äºç»´æŠ¤**: ä»£ç é›†ä¸­ç®¡ç†ï¼Œæ¥å£æ ‡å‡†åŒ–
- âœ… **å……åˆ†æµ‹è¯•**: å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿åŠŸèƒ½å¯é 

### 9.2 è®¾è®¡ä¼˜åŠ¿
- **é¿å…è¿‡åº¦å·¥ç¨‹åŒ–**: ä¸“æ³¨è§£å†³æ ¸å¿ƒé—®é¢˜
- **ä¿æŒGUIå…¼å®¹æ€§**: 100%ä¿æŒç°æœ‰GUIç»“æ„
- **è½»é‡çº§å®ç°**: æœ€å°åŒ–æ€§èƒ½å½±å“
- **æ˜“äºæ‰©å±•**: æ”¯æŒæœªæ¥æ·»åŠ æ–°ä¾èµ–

### 9.3 ç”¨æˆ·ä»·å€¼
- **æé«˜å¯ç”¨æ€§**: ç”¨æˆ·èƒ½å¤Ÿæ¸…æ¥šäº†è§£ä¾èµ–çŠ¶æ€
- **å‡å°‘å›°æƒ‘**: æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **æ”¹å–„ä½“éªŒ**: ä»…åœ¨éœ€è¦æ—¶æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
- **é™ä½æ”¯æŒæˆæœ¬**: è‡ªåŠ©å¼çš„é—®é¢˜è¯Šæ–­å’Œè§£å†³

è¿™ä¸ªè§£å†³æ–¹æ¡ˆæˆåŠŸåœ°ä¸ºPktMaskæä¾›äº†å®ç”¨ã€è½»é‡çº§çš„ä¾èµ–çŠ¶æ€æ˜¾ç¤ºåŠŸèƒ½ï¼Œæ˜¾è‘—æ”¹å–„äº†ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä¿æŒäº†ä»£ç çš„ç®€æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
