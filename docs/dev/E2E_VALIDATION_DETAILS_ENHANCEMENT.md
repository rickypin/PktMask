# E2Eæµ‹è¯•HTMLæŠ¥å‘ŠéªŒè¯è¯¦æƒ…å¢å¼º

## ğŸ“‹ æ”¹è¿›æ¦‚è¿°

ä¸ºHTMLæµ‹è¯•æŠ¥å‘Šæ·»åŠ äº†**è¯¦ç»†çš„åŸºçº¿æ¯”å¯¹ç»“æœ**,è®©æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½èƒ½æ¸…æ™°å±•ç¤ºéªŒè¯äº†å“ªäº›å…³é”®æŒ‡æ ‡,ä»¥åŠæ¯ä¸ªæŒ‡æ ‡çš„æ¯”å¯¹ç»“æœã€‚

## ğŸ¯ æ”¹è¿›ç›®æ ‡

1. **é€æ˜åŒ–éªŒè¯è¿‡ç¨‹** - æ¸…æ™°å±•ç¤ºæ¯ä¸ªæµ‹è¯•éªŒè¯äº†å“ªäº›æŒ‡æ ‡
2. **å¯è§†åŒ–æ¯”å¯¹ç»“æœ** - ç›´è§‚æ˜¾ç¤ºåŸºçº¿å€¼vså½“å‰å€¼çš„å¯¹æ¯”
3. **å¿«é€Ÿå®šä½é—®é¢˜** - ä¸€çœ¼çœ‹å‡ºå“ªä¸ªæŒ‡æ ‡ä¸åŒ¹é…
4. **å¢å¼ºå¯ä¿¡åº¦** - è¯¦ç»†çš„éªŒè¯è®°å½•å¢åŠ æµ‹è¯•å¯ä¿¡åº¦

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. åŸºçº¿æ¯”å¯¹è¡¨æ ¼

æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç°åœ¨éƒ½åŒ…å«ä¸€ä¸ªè¯¦ç»†çš„æ¯”å¯¹è¡¨æ ¼,æ˜¾ç¤º:

| æŒ‡æ ‡ | åŸºçº¿å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| Output File Hash (SHA256) | a1b2c3d4e5f6g7h8... | a1b2c3d4e5f6g7h8... | âœ… MATCH |
| Packet Count | 14 | 14 | âœ… MATCH |
| Output File Size (bytes) | 1234 | 1234 | âœ… MATCH |
| Packets Processed | 14 | 14 | âœ… MATCH |
| Packets Modified | 1 | 1 | âœ… MATCH |
| Duration (ms) | 123.45 | 125.67 | âœ… MATCH (tolerance: Â±247ms) |
| Stage Count | 1 | 1 | âœ… MATCH |

### 2. éªŒè¯æ£€æŸ¥åˆ—è¡¨

æ¯ä¸ªæµ‹è¯•è¿˜åŒ…å«ä¸€ä¸ªè¯¦ç»†çš„éªŒè¯æ£€æŸ¥åˆ—è¡¨:

- âœ… Output file hash matches baseline
- âœ… Packet count: 14 == 14
- âœ… File size: 1234 == 1234
- âœ… Packets processed: 14 == 14
- âœ… Packets modified: 1 == 1
- âœ… Duration within tolerance: 125.67ms vs 123.45ms (Â±247ms)
- âœ… Stage count: 1 == 1
- âœ… Stage 0 (DeduplicationStage): name matches
- âœ… Stage 0 (DeduplicationStage): packets processed 14 == 14
- âœ… Stage 0 (DeduplicationStage): packets modified 0 == 0

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. ä¿®æ”¹çš„æ–‡ä»¶

#### `tests/e2e/conftest.py`

**æ–°å¢å…¨å±€å˜é‡**:
```python
# Store validation details for each test
validation_details: Dict[str, Dict[str, Any]] = {}
```

**æ–°å¢fixture**:
```python
@pytest.fixture
def validation_tracker(request):
    """Fixture to track validation details for each test"""
    # åˆå§‹åŒ–éªŒè¯è¯¦æƒ…å­—å…¸
    # è¿”å›ç»™æµ‹è¯•ä½¿ç”¨
```

**å¢å¼ºpytest_runtest_makereport hook**:
```python
# è·å–éªŒè¯è¯¦æƒ…
test_validation = validation_details.get(test_id, {})
validations = test_validation.get('validations', [])
baseline_comp = test_validation.get('baseline_comparison', {})

# æ„å»ºHTMLè¡¨æ ¼æ˜¾ç¤ºæ¯”å¯¹ç»“æœ
# æ„å»ºéªŒè¯æ£€æŸ¥åˆ—è¡¨
```

#### `tests/e2e/test_e2e_golden_validation.py`

**æ–°å¢è¾…åŠ©æ–¹æ³•**:
```python
def _record_validation(self, test_id: str, metric: str, baseline_val, current_val, match: bool = True, tolerance: str = ""):
    """Record validation comparison for HTML report"""
    # è®°å½•æ¯ä¸ªæŒ‡æ ‡çš„æ¯”å¯¹ç»“æœ

def _record_check(self, test_id: str, description: str, passed: bool = True):
    """Record a validation check for HTML report"""
    # è®°å½•æ¯ä¸ªéªŒè¯æ£€æŸ¥
```

**ä¿®æ”¹éªŒè¯æ–¹æ³•**:
- `_verify_stats_consistency()` - æ·»åŠ test_idå‚æ•°,è®°å½•æ‰€æœ‰ç»Ÿè®¡éªŒè¯
- æ‰€æœ‰æµ‹è¯•æ–¹æ³• - åœ¨éªŒè¯å‰è®°å½•æ¯”å¯¹ç»“æœ

### 2. éªŒè¯æŒ‡æ ‡è¯¦è§£

#### æ ¸å¿ƒæŒ‡æ ‡

**Output File Hash (SHA256)**
- **è¯´æ˜**: è¾“å‡ºæ–‡ä»¶çš„SHA256å“ˆå¸Œå€¼
- **ç”¨é€”**: ç¡®ä¿è¾“å‡ºæ–‡ä»¶å†…å®¹å®Œå…¨ä¸€è‡´
- **æ˜¾ç¤º**: æ˜¾ç¤ºå‰16ä¸ªå­—ç¬¦ + "..."
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

**Packet Count**
- **è¯´æ˜**: å¤„ç†çš„æ•°æ®åŒ…æ€»æ•°
- **ç”¨é€”**: ç¡®ä¿å¤„ç†äº†æ­£ç¡®æ•°é‡çš„æ•°æ®åŒ…
- **æ˜¾ç¤º**: æ•´æ•°
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

**Output File Size (bytes)**
- **è¯´æ˜**: è¾“å‡ºæ–‡ä»¶çš„å­—èŠ‚å¤§å°
- **ç”¨é€”**: å¿«é€Ÿæ£€æŸ¥æ–‡ä»¶å¤§å°ä¸€è‡´æ€§
- **æ˜¾ç¤º**: å­—èŠ‚æ•°
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

#### ç»Ÿè®¡æŒ‡æ ‡

**Packets Processed**
- **è¯´æ˜**: å®é™…å¤„ç†çš„æ•°æ®åŒ…æ•°
- **ç”¨é€”**: éªŒè¯å¤„ç†æµç¨‹å®Œæ•´æ€§
- **æ˜¾ç¤º**: æ•´æ•°
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

**Packets Modified**
- **è¯´æ˜**: è¢«ä¿®æ”¹çš„æ•°æ®åŒ…æ•°
- **ç”¨é€”**: éªŒè¯å¤„ç†æ•ˆæœ
- **æ˜¾ç¤º**: æ•´æ•°
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

**Duration (ms)**
- **è¯´æ˜**: å¤„ç†è€—æ—¶(æ¯«ç§’)
- **ç”¨é€”**: æ€§èƒ½å‚è€ƒ(å…è®¸æ³¢åŠ¨)
- **æ˜¾ç¤º**: æµ®ç‚¹æ•°,ä¿ç•™2ä½å°æ•°
- **åŒ¹é…**: å…è®¸200%å®¹å·®æˆ–æœ€å°100ms

**Stage Count**
- **è¯´æ˜**: å¤„ç†é˜¶æ®µæ•°é‡
- **ç”¨é€”**: éªŒè¯å¤„ç†æµç¨‹é…ç½®
- **æ˜¾ç¤º**: æ•´æ•°
- **åŒ¹é…**: å®Œå…¨åŒ¹é…

#### é˜¶æ®µçº§æŒ‡æ ‡

æ¯ä¸ªå¤„ç†é˜¶æ®µéƒ½ä¼šéªŒè¯:
- **Stage Name**: é˜¶æ®µåç§°(å¦‚DeduplicationStage)
- **Packets Processed**: è¯¥é˜¶æ®µå¤„ç†çš„æ•°æ®åŒ…æ•°
- **Packets Modified**: è¯¥é˜¶æ®µä¿®æ”¹çš„æ•°æ®åŒ…æ•°

### 3. HTMLæŠ¥å‘Šå±•ç¤º

#### æµ‹è¯•è¯¦æƒ…åŒºåŸŸ

```html
<div class="test-details" style="margin: 15px 0; padding: 15px; background-color: #f9f9f9; border-radius: 5px;">
    <h4>Test Details</h4>
    <table>
        <tr><th>Test ID</th><td>E2E-001</td></tr>
        <tr><th>Duration</th><td>0.242s</td></tr>
        <tr><th>Status</th><td class="passed">PASSED</td></tr>
    </table>
    
    <h4>Baseline Validation Results</h4>
    <table class="baseline-comparison">
        <thead>
            <tr>
                <th>Metric</th>
                <th>Baseline</th>
                <th>Current</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- æ¯”å¯¹ç»“æœè¡Œ -->
        </tbody>
    </table>
    
    <h5>Validation Checks Performed:</h5>
    <ul>
        <li>âœ… Output file hash matches baseline</li>
        <li>âœ… Packet count: 14 == 14</li>
        <!-- æ›´å¤šæ£€æŸ¥é¡¹ -->
    </ul>
</div>
```

## ğŸ“Š éªŒè¯è¦†ç›–èŒƒå›´

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• (E2E-001 ~ E2E-007)

æ¯ä¸ªæµ‹è¯•éªŒè¯:
- âœ… è¾“å‡ºæ–‡ä»¶å“ˆå¸Œ
- âœ… æ•°æ®åŒ…æ•°é‡
- âœ… æ–‡ä»¶å¤§å°
- âœ… å¤„ç†ç»Ÿè®¡(packets processed/modified)
- âœ… æ‰§è¡Œæ—¶é—´(å¸¦å®¹å·®)
- âœ… é˜¶æ®µæ•°é‡
- âœ… æ¯ä¸ªé˜¶æ®µçš„è¯¦ç»†ç»Ÿè®¡

**ç¤ºä¾‹ - E2E-001 (ä»…å»é‡)**:
- éªŒè¯å»é‡é˜¶æ®µæ­£ç¡®æ‰§è¡Œ
- éªŒè¯æ²¡æœ‰æ•°æ®åŒ…è¢«å»é‡(0% deduplication rate)
- éªŒè¯æ‰€æœ‰14ä¸ªæ•°æ®åŒ…éƒ½è¢«å¤„ç†

### åè®®è¦†ç›–æµ‹è¯• (E2E-101 ~ E2E-106)

æ¯ä¸ªæµ‹è¯•éªŒè¯:
- âœ… åè®®ç‰¹å®šçš„è¾“å‡ºå“ˆå¸Œ
- âœ… åè®®ç‰¹å®šçš„æ•°æ®åŒ…æ•°é‡
- âœ… å¤šé˜¶æ®µå¤„ç†(å»é‡+åŒ¿ååŒ–+æ©ç )
- âœ… æ¯ä¸ªé˜¶æ®µçš„å¤„ç†æ•ˆæœ

**ç¤ºä¾‹ - E2E-105 (HTTP)**:
- éªŒè¯HTTPåè®®å¤„ç†æ­£ç¡®
- éªŒè¯å¤§æ–‡ä»¶å¤„ç†(10000+æ•°æ®åŒ…)
- éªŒè¯æ‰€æœ‰ä¸‰ä¸ªé˜¶æ®µéƒ½æ­£ç¡®æ‰§è¡Œ

### å°è£…ç±»å‹æµ‹è¯• (E2E-201 ~ E2E-203)

æ¯ä¸ªæµ‹è¯•éªŒè¯:
- âœ… ä¸åŒå°è£…ç±»å‹çš„å¤„ç†
- âœ… VLANæ ‡ç­¾å¤„ç†æ­£ç¡®æ€§
- âœ… å¤æ‚ç½‘ç»œç¯å¢ƒä¸‹çš„ä¸€è‡´æ€§

**ç¤ºä¾‹ - E2E-202 (Single VLAN)**:
- éªŒè¯å•å±‚VLANå¤„ç†
- éªŒè¯2111ä¸ªæ•°æ®åŒ…å…¨éƒ¨å¤„ç†
- éªŒè¯1268ä¸ªæ•°æ®åŒ…è¢«ä¿®æ”¹

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥çœ‹æµ‹è¯•éªŒè¯è¯¦æƒ…

1. **è¿è¡Œæµ‹è¯•ç”ŸæˆæŠ¥å‘Š**:
   ```bash
   ./tests/e2e/run_e2e_tests.sh --all --open
   ```

2. **åœ¨HTMLæŠ¥å‘Šä¸­æŸ¥çœ‹**:
   - ç‚¹å‡»ä»»æ„æµ‹è¯•ç”¨ä¾‹
   - å±•å¼€"Test Details"åŒºåŸŸ
   - æŸ¥çœ‹"Baseline Validation Results"è¡¨æ ¼
   - æŸ¥çœ‹"Validation Checks Performed"åˆ—è¡¨

3. **å¿«é€Ÿå®šä½é—®é¢˜**:
   - çº¢è‰²âŒè¡¨ç¤ºä¸åŒ¹é…
   - ç»¿è‰²âœ…è¡¨ç¤ºåŒ¹é…
   - æŸ¥çœ‹Statusåˆ—äº†è§£è¯¦ç»†çŠ¶æ€

### ç†è§£éªŒè¯ç»“æœ

**å®Œå…¨åŒ¹é…**:
```
Metric: Packet Count
Baseline: 14
Current: 14
Status: âœ… MATCH
```

**å®¹å·®åŒ¹é…**:
```
Metric: Duration (ms)
Baseline: 123.45
Current: 125.67
Status: âœ… MATCH (tolerance: Â±247ms)
```

**ä¸åŒ¹é…(ç¤ºä¾‹)**:
```
Metric: Packet Count
Baseline: 14
Current: 13
Status: âŒ MISMATCH
```

## ğŸ¯ æ”¹è¿›æ•ˆæœ

### 1. é€æ˜åº¦æå‡

**ä¹‹å‰**: åªçŸ¥é“æµ‹è¯•é€šè¿‡æˆ–å¤±è´¥
**ç°åœ¨**: æ¸…æ¥šçŸ¥é“éªŒè¯äº†å“ªäº›æŒ‡æ ‡,æ¯ä¸ªæŒ‡æ ‡çš„ç»“æœ

### 2. è°ƒè¯•æ•ˆç‡æå‡

**ä¹‹å‰**: æµ‹è¯•å¤±è´¥æ—¶éœ€è¦æŸ¥çœ‹æ—¥å¿—æ‰¾åŸå› 
**ç°åœ¨**: ç›´æ¥åœ¨HTMLæŠ¥å‘Šä¸­çœ‹åˆ°å“ªä¸ªæŒ‡æ ‡ä¸åŒ¹é…

### 3. å¯ä¿¡åº¦æå‡

**ä¹‹å‰**: ä¸æ¸…æ¥šæµ‹è¯•çš„è¦†ç›–èŒƒå›´
**ç°åœ¨**: è¯¦ç»†çš„éªŒè¯åˆ—è¡¨å±•ç¤ºå®Œæ•´çš„æµ‹è¯•è¦†ç›–

### 4. æ–‡æ¡£ä»·å€¼æå‡

**ä¹‹å‰**: æŠ¥å‘Šåªæ˜¯æµ‹è¯•ç»“æœè®°å½•
**ç°åœ¨**: æŠ¥å‘Šæˆä¸ºéªŒè¯æ–¹æ³•çš„æ–‡æ¡£

## ğŸ“ˆ ç»Ÿè®¡æ•°æ®

### éªŒè¯æŒ‡æ ‡æ•°é‡

æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯çš„æŒ‡æ ‡æ•°é‡:

- **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**: 7-15ä¸ªæŒ‡æ ‡
  - åŸºç¡€æŒ‡æ ‡: 7ä¸ª
  - é˜¶æ®µæŒ‡æ ‡: æ¯ä¸ªé˜¶æ®µ3ä¸ª Ã— é˜¶æ®µæ•°

- **åè®®è¦†ç›–æµ‹è¯•**: 7-15ä¸ªæŒ‡æ ‡
  - åŸºç¡€æŒ‡æ ‡: 7ä¸ª
  - é˜¶æ®µæŒ‡æ ‡: é€šå¸¸3ä¸ªé˜¶æ®µ Ã— 3 = 9ä¸ª

- **å°è£…ç±»å‹æµ‹è¯•**: 7-12ä¸ªæŒ‡æ ‡
  - åŸºç¡€æŒ‡æ ‡: 7ä¸ª
  - é˜¶æ®µæŒ‡æ ‡: 2ä¸ªé˜¶æ®µ Ã— 3 = 6ä¸ª

### æ€»éªŒè¯æ£€æŸ¥æ•°

- **16ä¸ªæµ‹è¯•ç”¨ä¾‹**
- **æ¯ä¸ªç”¨ä¾‹å¹³å‡10ä¸ªéªŒè¯æŒ‡æ ‡**
- **æ€»è®¡çº¦160ä¸ªéªŒè¯æ£€æŸ¥**

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [E2Eæµ‹è¯•README](../../tests/e2e/README.md)
- [HTMLæŠ¥å‘Šä½¿ç”¨æŒ‡å—](../../tests/e2e/REPORT_GUIDE.md)
- [E2Eæµ‹è¯•æ”¹è¿›æ–¹æ¡ˆ](E2E_TEST_IMPROVEMENTS.md)
- [E2Eæµ‹è¯•è®¡åˆ’](E2E_TEST_PLAN.md)

## ğŸ“ åç»­æ”¹è¿›å»ºè®®

1. **æ·»åŠ è¶‹åŠ¿å›¾è¡¨** - æ˜¾ç¤ºå†å²æµ‹è¯•çš„æ€§èƒ½è¶‹åŠ¿
2. **æ·»åŠ å·®å¼‚é«˜äº®** - å¯¹ä¸åŒ¹é…çš„å€¼è¿›è¡Œé«˜äº®æ˜¾ç¤º
3. **æ·»åŠ å¯¼å‡ºåŠŸèƒ½** - æ”¯æŒå¯¼å‡ºéªŒè¯è¯¦æƒ…ä¸ºCSV/Excel
4. **æ·»åŠ å¯¹æ¯”è§†å›¾** - æ”¯æŒå¤šæ¬¡æµ‹è¯•ç»“æœçš„å¹¶æ’å¯¹æ¯”

