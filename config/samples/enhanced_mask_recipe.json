{
  "total_packets": 30,
  "metadata": {
    "recipe_name": "增强掩码策略配方",
    "version": "2.0",
    "description": "展示TLS协议掩码和非TLS TCP载荷掩码的完整策略",
    "author": "PktMask增强版",
    "created_date": "2025-01-22",
    "use_cases": [
      "TLS协议智能掩码",
      "非TLS TCP载荷全掩码",
      "混合协议流量处理",
      "企业网络安全脱敏"
    ],
    "network_protocols": ["HTTP", "HTTPS", "TLS", "TCP", "SSH", "FTP"],
    "mask_strategies": {
      "tls_preserve_headers": "保留TLS协议头部信息",
      "tls_mask_payload": "掩码TLS应用数据载荷", 
      "non_tls_mask_all": "非TLS TCP载荷全部掩码",
      "protocol_aware": "协议感知的差异化掩码"
    },
    "security_level": "高级 - 协议感知掩码"
  },
  "instructions": [
    {
      "packet_index": 0,
      "packet_timestamp": "1739953296.645501",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TCP SYN - 连接建立，完全保留"
    },
    {
      "packet_index": 1,
      "packet_timestamp": "1739953296.941416",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TCP SYN-ACK - 连接响应，完全保留"
    },
    {
      "packet_index": 2,
      "packet_timestamp": "1739953296.941416",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TCP ACK - 连接确认，完全保留"
    },
    {
      "packet_index": 3,
      "packet_timestamp": "1739953296.941416",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Client Hello - 握手开始，完全保留"
    },
    {
      "packet_index": 4,
      "packet_timestamp": "1739953297.020306",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Server Hello - 服务器响应，完全保留"
    },
    {
      "packet_index": 5,
      "packet_timestamp": "1739953297.024065",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Certificate - 证书交换，完全保留"
    },
    {
      "packet_index": 6,
      "packet_timestamp": "1739953297.024296",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Server Hello Done - 握手完成信号，完全保留"
    },
    {
      "packet_index": 7,
      "packet_timestamp": "1739953297.025396",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Client Key Exchange - 密钥交换，完全保留"
    },
    {
      "packet_index": 8,
      "packet_timestamp": "1739953297.026958",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Change Cipher Spec - 加密参数变更，完全保留"
    },
    {
      "packet_index": 9,
      "packet_timestamp": "1739953297.101993",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Finished (Client) - 客户端握手完成，完全保留"
    },
    {
      "packet_index": 10,
      "packet_timestamp": "1739953297.142473",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Change Cipher Spec (Server) - 服务器加密变更，完全保留"
    },
    {
      "packet_index": 11,
      "packet_timestamp": "1739953297.206658",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Finished (Server) - 服务器握手完成，完全保留"
    },
    {
      "packet_index": 12,
      "packet_timestamp": "1739953297.206658",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 5
      },
      "comment": "TLS Application Data - 保留TLS记录头(5字节)，掩码应用数据"
    },
    {
      "packet_index": 13,
      "packet_timestamp": "1739953297.206658",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 5
      },
      "comment": "TLS Application Data - 保留TLS记录头(5字节)，掩码应用数据"
    },
    {
      "packet_index": 14,
      "packet_timestamp": "1739953297.260583",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 5
      },
      "comment": "TLS Application Data - 保留TLS记录头(5字节)，掩码应用数据"
    },
    {
      "packet_index": 15,
      "packet_timestamp": "1739953297.262132",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 0
      },
      "comment": "非TLS TCP载荷 - HTTP请求，全部掩码保护敏感数据"
    },
    {
      "packet_index": 16,
      "packet_timestamp": "1739953297.262361",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 0
      },
      "comment": "非TLS TCP载荷 - HTTP响应，全部掩码保护敏感数据"
    },
    {
      "packet_index": 17,
      "packet_timestamp": "1739953297.326384",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 0
      },
      "comment": "非TLS TCP载荷 - SSH协议，全部掩码保护认证信息"
    },
    {
      "packet_index": 18,
      "packet_timestamp": "1739953297.327140",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 0
      },
      "comment": "非TLS TCP载荷 - FTP命令，全部掩码保护用户凭据"
    },
    {
      "packet_index": 19,
      "packet_timestamp": "1739953297.400123",
      "payload_offset": 54,
      "mask_spec_type": "MaskAfter",
      "mask_spec_params": {
        "keep_bytes": 5
      },
      "comment": "TLS Application Data - 保留TLS记录头(5字节)，掩码应用数据"
    },
    {
      "packet_index": 20,
      "packet_timestamp": "1739953297.450234",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TLS Alert - 连接关闭警告，完全保留"
    },
    {
      "packet_index": 21,
      "packet_timestamp": "1739953298.100456",
      "payload_offset": 54,
      "mask_spec_type": "KeepAll",
      "mask_spec_params": {},
      "comment": "TCP FIN - 连接终止，完全保留"
    }
  ],
  "enhanced_masking_strategy": {
    "tls_protocol_handling": {
      "tls_20_changecipherspec": {
        "policy": "完全保留",
        "reason": "协议状态变更信息对分析重要"
      },
      "tls_21_alert": {
        "policy": "完全保留",
        "reason": "错误和警告信息对诊断重要"
      },
      "tls_22_handshake": {
        "policy": "完全保留",
        "reason": "握手过程对协议分析至关重要"
      },
      "tls_23_applicationdata": {
        "policy": "保留头部，掩码载荷",
        "header_bytes": 5,
        "reason": "保护用户数据隐私，保留协议结构"
      },
      "tls_24_heartbeat": {
        "policy": "完全保留",
        "reason": "心跳消息对连接状态监控重要"
      }
    },
    "non_tls_tcp_handling": {
      "policy": "全载荷掩码",
      "reason": "未识别协议采用最保守的全掩码策略",
      "affected_protocols": [
        "HTTP明文传输",
        "SSH加密协议",
        "FTP文件传输",
        "SMTP邮件传输",
        "其他未识别的TCP协议"
      ],
      "security_rationale": "对于无法识别为TLS的TCP载荷，采用全掩码策略确保敏感信息不会泄露"
    }
  },
  "security_considerations": {
    "preserved_information": [
      "TLS版本和协议类型",
      "握手消息结构",
      "记录层头部信息",
      "连接状态变化",
      "协议错误和警告"
    ],
    "masked_information": [
      "TLS应用层数据内容",
      "非TLS协议的所有载荷数据",
      "用户认证凭据",
      "传输的实际数据内容",
      "敏感的业务信息"
    ],
    "privacy_level": "高级协议感知保护 - 最大化隐私保护同时保留协议可分析性"
  },
  "implementation_notes": {
    "automatic_detection": "系统自动识别TLS记录类型并应用相应策略",
    "fallback_strategy": "未识别为TLS的TCP载荷自动应用全掩码策略",
    "performance_impact": "协议识别增加少量处理开销，但显著提升安全性",
    "compatibility": "与现有TLS掩码策略完全兼容，仅扩展处理范围"
  }
}
