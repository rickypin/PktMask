2025-07-22 17:08:49,429 - PipelineDebug - INFO - Starting PktMask Pipeline Debug Session
2025-07-22 17:08:49,429 - PipelineDebug - INFO - Created test directory: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2
2025-07-22 17:08:49,430 - PipelineDebug - INFO - Copied tests/samples/tls-single/tls_sample.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:49,431 - PipelineDebug - INFO - Copied tests/samples/http-single/http-500error.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:49,431 - PipelineDebug - INFO - Test config: {'remove_dupes': {'enabled': True}, 'anonymize_ips': {'enabled': True}, 'mask_payloads': {'enabled': True, 'protocol': 'tls', 'mode': 'enhanced'}}
2025-07-22 17:08:49,431 - PipelineDebug - INFO - === DEBUGGING PIPELINE EXECUTOR ===
2025-07-22 17:08:49,500 - PipelineDebug - INFO - Successfully imported PipelineExecutor
2025-07-22 17:08:49,759 - pktmask.reporting - INFO - HTML template loaded successfully
2025-07-22 17:08:49,759 - pktmask.unified_deduplication - INFO - UnifiedDeduplicationStage created: algorithm=md5
2025-07-22 17:08:49,759 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - DeduplicationStage created: enabled=True, name=deduplication
2025-07-22 17:08:49,759 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Unified deduplication stage initialization successful
2025-07-22 17:08:49,760 - pktmask.unified_ip_anonymization - INFO - UnifiedIPAnonymizationStage created: method=prefix_preserving
2025-07-22 17:08:49,760 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IPAnonymizationStage created: method=prefix_preserving, ipv4_prefix=24, ipv6_prefix=64
2025-07-22 17:08:49,760 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Unified IP anonymization stage initialization successful
2025-07-22 17:08:49,760 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - NewMaskPayloadStage created: protocol=tls, mode=enhanced
2025-07-22 17:08:49,760 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting NewMaskPayloadStage initialization
2025-07-22 17:08:49,762 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,095 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,096 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,096 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLSProtocolMarker 初始化成功
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.memory_optimizer.MemoryOptimizer - INFO - 内存优化器初始化: 最大内存=2048MB, GC阈值=80.0%
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - DEBUG - 注册恢复处理器: memory_error
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - DEBUG - 注册恢复处理器: input_error
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - DEBUG - 注册恢复处理器: output_error
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - INFO - 错误处理器初始化: 最大重试=3, 自动恢复=启用
2025-07-22 17:08:50,100 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - INFO - 数据验证器初始化: 校验和验证=启用
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.mask_payload_v2.masker.fallback_handler.FallbackHandler - INFO - 降级处理器初始化: 默认模式=copy_original, 启用=是
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - DEBUG - 注册恢复处理器: input_error
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.mask_payload_v2.masker.error_handler.ErrorRecoveryHandler - DEBUG - 注册恢复处理器: processing_error
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - PayloadMasker initialized: chunk_size=1000, verify_checksums=True, memory_limit=2048MB
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - NewMaskPayloadStage initialization successful
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Created PipelineExecutor with 3 stages
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Stage 0: DeduplicationStage - DeduplicationStage
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Initialized: True
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Config: N/A
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Stage 1: IPAnonymizationStage - IPAnonymizationStage
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Initialized: True
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Config: N/A
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Stage 2: NewMaskPayloadStage - NewMaskPayloadStage
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Initialized: True
2025-07-22 17:08:50,101 - PipelineDebug - INFO -   Config: {'enabled': True, 'protocol': 'tls', 'mode': 'enhanced'}
2025-07-22 17:08:50,101 - PipelineDebug - INFO - === RUNNING 3 ITERATIONS ===
2025-07-22 17:08:50,101 - PipelineDebug - INFO - 
--- ITERATION 1 ---
2025-07-22 17:08:50,101 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap ===
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:50,101 - PipelineDebug - INFO - Input size: 4717 bytes
2025-07-22 17:08:50,101 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:50,103 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:50,105 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 22 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:50,105 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/22 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:50,105 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:50,105 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=22 packets_modified=0 duration_ms=3.495931625366211 extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.003495931625366211, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:50,105 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_0_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:50,107 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:50,107 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:50,107 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:50,179 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,179 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,179 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,179 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,179 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,179 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,179 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,179 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,180 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,180 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,180 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,180 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,180 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,180 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,181 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,181 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,181 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,181 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,181 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,182 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,182 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,182 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,182 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,182 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,183 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,183 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,183 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,183 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,183 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,183 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,183 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,183 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,183 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,184 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,184 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,184 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,184 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,185 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,185 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,185 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,185 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,185 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,185 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,185 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,185 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,185 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,186 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,186 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,186 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,186 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,186 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,187 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,187 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,187 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,187 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,187 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,187 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,187 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.080s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.08s
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=22, encapsulated=0, multi-layer IP=0, normal=22
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 22}
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'10': 44}
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'10.171': 22, '10.50': 22}
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=1, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=1, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.171 (frequency:22) → 8.178
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.50 (frequency:22) → 8.49
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'10': '8'}
2025-07-22 17:08:50,187 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.080s total_ips=2 files_processed=1
2025-07-22 17:08:50,187 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.08s
2025-07-22 17:08:50,188 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:50,188 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.detector - DEBUG - Detected encapsulation type: plain
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.detector - INFO - Packet encapsulation type detection completed: plain
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,188 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,188 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,189 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,189 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,190 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,190 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,190 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,190 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,193 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 22 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:50,193 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 22/22 packets modified
2025-07-22 17:08:50,193 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:50,193 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=22 packets_modified=22 duration_ms=88.11187744140625 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:50,194 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:50,194 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:50,194 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:50,194 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:50,194 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,294 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,294 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,294 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:50,507 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 22 reassembled packets, 22 segment packets, 10 after merge
2025-07-22 17:08:50,507 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 10 packets containing TLS messages
2025-07-22 17:08:50,507 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 1 TCP flows
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422049782-2422050299
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050299-2422050374
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-20 seq 2422050374-2422050380
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050380-2422050425
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050425-2422050430
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050599-2422050604
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-21 seq 2422050630-2422050661
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913402951-3913404764
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-20 seq 3913404764-3913404770
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913404770-3913404815
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-23 seq 3913404815-3913404820
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-21 seq 3913404926-3913404957
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.42 seconds, generated 12 keep rules
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:50,610 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:50,612 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_8iliwxes/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:50,612 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:50,613 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:forward - original ranges: 7, after merge: 4, header_only: 2, full_preserve: 2, boundary points: 7
2025-07-22 17:08:50,613 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:reverse - original ranges: 5, after merge: 3, header_only: 1, full_preserve: 2, boundary points: 5
2025-07-22 17:08:50,613 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 1 flow directions total
2025-07-22 17:08:50,613 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:50,619 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 8.178.236.80:33492-8.49.51.161:443 -> 0
2025-07-22 17:08:50,619 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=8.178.236.80:33492->8.49.51.161:443
2025-07-22 17:08:50,619 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,620 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,620 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,620 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,621 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,622 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,622 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,622 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,622 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,622 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,623 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,624 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,624 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,624 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,624 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:50,625 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:50,627 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:50,628 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:50,632 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:50,632 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=22, modified_packets=2, execution_time=0.02s, peak_memory=109.4MB, gc_count=0
2025-07-22 17:08:50,632 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=22, modified_packets=2
2025-07-22 17:08:50,632 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:50,632 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=22 packets_modified=2 duration_ms=21.81720733642578 extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.12663373694103247, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap' duration_ms=531.3229560852051 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=22, packets_modified=0, duration_ms=3.495931625366211, extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.003495931625366211, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=22, packets_modified=22, duration_ms=88.11187744140625, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=22, packets_modified=2, duration_ms=21.81720733642578, extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.12663373694103247, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:50,633 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Duration: 3.495931625366211ms
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.003495931625366211, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:50,633 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Modified: 22
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Duration: 88.11187744140625ms
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:50,633 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Modified: 2
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Duration: 21.81720733642578ms
2025-07-22 17:08:50,633 - PipelineDebug - INFO -     Extra: {'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.12663373694103247, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Output size: 4717 bytes
2025-07-22 17:08:50,633 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng ===
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:50,633 - PipelineDebug - INFO - Input size: 51228 bytes
2025-07-22 17:08:50,633 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:50,634 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:50,635 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 12 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:50,635 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/12 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:50,635 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:50,635 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=12 packets_modified=0 duration_ms=1.9428730010986328 extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019428730010986328, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:50,635 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_0_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:50,636 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:50,636 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:50,636 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:50,636 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,636 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,636 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,637 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,637 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,637 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,637 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,637 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,637 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,638 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,638 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,638 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,638 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,638 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,638 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,639 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,639 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,639 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:50,639 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.002s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.00s
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=34, encapsulated=0, multi-layer IP=0, normal=34
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 56}
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'192': 12, '209': 12}
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'192.168': 12, '209.31': 12}
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=2, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=2, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 192.168 (frequency:12) → 197.184
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 209.31 (frequency:12) → 208.36
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'192': '197', '209': '208'}
2025-07-22 17:08:50,639 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.003s total_ips=2 files_processed=1
2025-07-22 17:08:50,639 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.00s
2025-07-22 17:08:50,639 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:50,639 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:50,639 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,639 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,639 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,639 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,639 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,639 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,640 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:50,640 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:50,642 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 12 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:50,642 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 12/12 packets modified
2025-07-22 17:08:50,642 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:50,642 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=12 packets_modified=12 duration_ms=6.945133209228516 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:50,642 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:50,643 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:50,643 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:50,643 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:50,643 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,744 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,745 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:50,745 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:50,950 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 12 reassembled packets, 12 segment packets, 0 after merge
2025-07-22 17:08:50,950 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 0 packets containing TLS messages
2025-07-22 17:08:50,950 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 0 TCP flows
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.31 seconds, generated 0 keep rules
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:50,951 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_m_zxq6cs/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 0 flow directions total
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 197.184.3.113:3541-208.36.26.39:80 -> 0
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=197.184.3.113:3541->208.36.26.39:80
2025-07-22 17:08:50,952 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=forward
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,953 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,954 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:50,955 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:50,957 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:50,957 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:50,958 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:50,958 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=12, modified_packets=7, execution_time=0.01s, peak_memory=109.5MB, gc_count=0
2025-07-22 17:08:50,959 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=12, modified_packets=7
2025-07-22 17:08:50,959 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:50,959 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=12 packets_modified=7 duration_ms=7.647991180419922 extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5934285179874057, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng' duration_ms=325.4280090332031 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=12, packets_modified=0, duration_ms=1.9428730010986328, extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019428730010986328, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=12, packets_modified=12, duration_ms=6.945133209228516, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=12, packets_modified=7, duration_ms=7.647991180419922, extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5934285179874057, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:50,959 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Duration: 1.9428730010986328ms
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019428730010986328, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:50,959 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Modified: 12
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Duration: 6.945133209228516ms
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:50,959 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Modified: 7
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Duration: 7.647991180419922ms
2025-07-22 17:08:50,959 - PipelineDebug - INFO -     Extra: {'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5934285179874057, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:50,959 - PipelineDebug - INFO - Output size: 5639 bytes
2025-07-22 17:08:51,964 - PipelineDebug - INFO - 
--- ITERATION 2 ---
2025-07-22 17:08:51,965 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap ===
2025-07-22 17:08:51,965 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:51,966 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:51,966 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:51,966 - PipelineDebug - INFO - Input size: 4717 bytes
2025-07-22 17:08:51,967 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:51,988 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:51,993 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 22 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:51,994 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/22 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:51,994 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:51,994 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=22 packets_modified=0 duration_ms=25.510072708129883 extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.025510072708129883, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:51,994 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_0_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:51,999 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:51,999 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:52,000 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:52,000 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,000 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,000 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,000 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,000 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,000 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,001 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,001 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,001 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,001 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,002 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,002 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,002 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,002 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,002 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,003 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,003 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,003 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,003 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,004 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,004 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,004 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,004 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,005 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,005 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,005 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,005 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,005 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,005 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,006 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,006 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,006 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,007 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,007 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,007 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,007 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,008 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,008 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,008 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,008 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,009 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,009 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,009 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,009 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,009 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,009 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,009 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.009s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.01s
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=56, encapsulated=0, multi-layer IP=0, normal=56
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 90}
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'10': 44}
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'10.171': 22, '10.50': 22}
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=1, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:52,009 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=1, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.171 (frequency:22) → 8.178
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.50 (frequency:22) → 8.49
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'10': '8'}
2025-07-22 17:08:52,010 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.010s total_ips=2 files_processed=1
2025-07-22 17:08:52,010 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.01s
2025-07-22 17:08:52,010 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:52,010 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:52,010 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,010 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,010 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,010 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,010 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,010 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,010 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,011 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,011 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,012 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,012 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,013 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,013 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,013 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,013 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,013 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,013 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,013 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,013 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 22 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 22/22 packets modified
2025-07-22 17:08:52,021 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:52,021 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=22 packets_modified=22 duration_ms=26.736974716186523 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:52,021 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,127 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,128 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,128 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:52,331 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 22 reassembled packets, 22 segment packets, 10 after merge
2025-07-22 17:08:52,331 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 10 packets containing TLS messages
2025-07-22 17:08:52,331 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:52,434 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 1 TCP flows
2025-07-22 17:08:52,434 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422049782-2422050299
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050299-2422050374
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-20 seq 2422050374-2422050380
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050380-2422050425
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050425-2422050430
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050599-2422050604
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-21 seq 2422050630-2422050661
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913402951-3913404764
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-20 seq 3913404764-3913404770
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913404770-3913404815
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-23 seq 3913404815-3913404820
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-21 seq 3913404926-3913404957
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.41 seconds, generated 12 keep rules
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:52,435 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_hmdekvv3/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:forward - original ranges: 7, after merge: 4, header_only: 2, full_preserve: 2, boundary points: 7
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:reverse - original ranges: 5, after merge: 3, header_only: 1, full_preserve: 2, boundary points: 5
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 1 flow directions total
2025-07-22 17:08:52,437 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:52,438 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 8.178.236.80:33492-8.49.51.161:443 -> 0
2025-07-22 17:08:52,438 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=8.178.236.80:33492->8.49.51.161:443
2025-07-22 17:08:52,438 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,438 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,438 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,439 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,440 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,441 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,441 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,441 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,441 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,441 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,442 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:52,443 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:52,445 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:52,445 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:52,450 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:52,450 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=22, modified_packets=2, execution_time=0.01s, peak_memory=110.1MB, gc_count=0
2025-07-22 17:08:52,450 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=22, modified_packets=2
2025-07-22 17:08:52,450 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:52,450 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=22 packets_modified=2 duration_ms=14.786005020141602 extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.18685199219568827, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:52,450 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap' duration_ms=483.00790786743164 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=22, packets_modified=0, duration_ms=25.510072708129883, extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.025510072708129883, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=22, packets_modified=22, duration_ms=26.736974716186523, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=22, packets_modified=2, duration_ms=14.786005020141602, extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.18685199219568827, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:52,450 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:52,450 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:52,450 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:52,450 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:52,450 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:52,450 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:52,450 - PipelineDebug - INFO -     Duration: 25.510072708129883ms
2025-07-22 17:08:52,450 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.025510072708129883, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:52,450 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:52,450 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Modified: 22
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Duration: 26.736974716186523ms
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:52,451 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Modified: 2
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Duration: 14.786005020141602ms
2025-07-22 17:08:52,451 - PipelineDebug - INFO -     Extra: {'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.18685199219568827, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Output size: 4717 bytes
2025-07-22 17:08:52,451 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng ===
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:52,451 - PipelineDebug - INFO - Input size: 51228 bytes
2025-07-22 17:08:52,451 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:52,452 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:52,453 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 12 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:52,453 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/12 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:52,453 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:52,453 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=12 packets_modified=0 duration_ms=2.007007598876953 extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.002007007598876953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:52,453 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_0_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:52,454 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:52,454 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:52,454 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:52,454 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,454 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,454 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,455 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,455 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,455 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,455 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,455 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,455 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,456 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,456 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:52,457 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.002s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.00s
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=68, encapsulated=0, multi-layer IP=0, normal=68
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 124}
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'192': 12, '209': 12}
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'192.168': 12, '209.31': 12}
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=2, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=2, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 192.168 (frequency:12) → 197.184
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 209.31 (frequency:12) → 208.36
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'192': '197', '209': '208'}
2025-07-22 17:08:52,457 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.003s total_ips=2 files_processed=1
2025-07-22 17:08:52,457 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.00s
2025-07-22 17:08:52,457 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:52,457 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:52,457 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,457 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,457 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,457 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,457 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,457 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,457 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,457 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,457 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,457 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,458 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:52,458 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:52,460 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 12 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:52,460 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 12/12 packets modified
2025-07-22 17:08:52,460 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:52,460 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=12 packets_modified=12 duration_ms=7.215976715087891 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:52,460 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:52,460 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:52,460 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:52,461 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:52,461 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,564 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,564 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:52,564 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:52,770 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 12 reassembled packets, 12 segment packets, 0 after merge
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 0 packets containing TLS messages
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 0 TCP flows
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.31 seconds, generated 0 keep rules
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:52,771 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_s7e33zm9/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 0 flow directions total
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 197.184.3.113:3541-208.36.26.39:80 -> 0
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=197.184.3.113:3541->208.36.26.39:80
2025-07-22 17:08:52,772 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=forward
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,773 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,774 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:52,775 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:52,776 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:52,776 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:52,778 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:52,778 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=12, modified_packets=7, execution_time=0.01s, peak_memory=110.3MB, gc_count=0
2025-07-22 17:08:52,779 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=12, modified_packets=7
2025-07-22 17:08:52,779 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:52,779 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=12 packets_modified=7 duration_ms=7.607936859130859 extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.596552804763397, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng' duration_ms=327.78215408325195 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=12, packets_modified=0, duration_ms=2.007007598876953, extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.002007007598876953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=12, packets_modified=12, duration_ms=7.215976715087891, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=12, packets_modified=7, duration_ms=7.607936859130859, extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.596552804763397, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:52,779 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Duration: 2.007007598876953ms
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.002007007598876953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:52,779 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Modified: 12
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Duration: 7.215976715087891ms
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:52,779 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Modified: 7
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Duration: 7.607936859130859ms
2025-07-22 17:08:52,779 - PipelineDebug - INFO -     Extra: {'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.596552804763397, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:52,779 - PipelineDebug - INFO - Output size: 5639 bytes
2025-07-22 17:08:53,784 - PipelineDebug - INFO - 
--- ITERATION 3 ---
2025-07-22 17:08:53,784 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap ===
2025-07-22 17:08:53,784 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:53,784 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:53,784 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:53,784 - PipelineDebug - INFO - Input size: 4717 bytes
2025-07-22 17:08:53,785 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:53,788 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap
2025-07-22 17:08:53,791 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 22 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:53,791 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/22 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:53,791 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:53,791 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=22 packets_modified=0 duration_ms=6.356954574584961 extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.006356954574584961, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:53,791 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_0_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:53,794 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 22 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_0_tls_sample_processed.pcap
2025-07-22 17:08:53,794 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:53,794 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:53,794 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,794 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,794 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,795 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,795 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,795 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,795 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,795 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,795 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,795 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,796 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,796 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,796 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,796 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,797 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,797 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,797 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,797 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,798 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,798 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,798 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,798 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,798 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,799 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,799 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,799 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,799 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,799 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,800 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,800 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,800 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,800 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,800 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:53,800 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.006s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:53,800 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.01s
2025-07-22 17:08:53,800 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=90, encapsulated=0, multi-layer IP=0, normal=90
2025-07-22 17:08:53,800 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 158}
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'10': 44}
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'10.171': 22, '10.50': 22}
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=1, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=1, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.171 (frequency:22) → 8.178
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 10.50 (frequency:22) → 8.49
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'10': '8'}
2025-07-22 17:08:53,801 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.007s total_ips=2 files_processed=1
2025-07-22 17:08:53,801 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.01s
2025-07-22 17:08:53,801 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:53,801 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:53,801 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,801 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,801 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,801 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,801 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,801 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,801 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,801 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,802 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,802 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,803 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,803 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:53,804 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:53,809 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 22 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:53,809 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 22/22 packets modified
2025-07-22 17:08:53,809 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:53,809 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=22 packets_modified=22 duration_ms=18.00704002380371 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:53,809 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:53,809 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:53,809 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:53,810 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:53,810 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:53,912 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:53,912 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:53,912 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:54,136 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 22 reassembled packets, 22 segment packets, 10 after merge
2025-07-22 17:08:54,137 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 10 packets containing TLS messages
2025-07-22 17:08:54,137 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:54,242 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 1 TCP flows
2025-07-22 17:08:54,242 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:54,242 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422049782-2422050299
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050299-2422050374
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-20 seq 2422050374-2422050380
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-22 seq 2422050380-2422050425
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050425-2422050430
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-23 seq 2422050599-2422050604
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-forward TLS-21 seq 2422050630-2422050661
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913402951-3913404764
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-20 seq 3913404764-3913404770
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-22 seq 3913404770-3913404815
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-23 seq 3913404815-3913404820
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generated precise keep rule: flow 0-reverse TLS-21 seq 3913404926-3913404957
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.43 seconds, generated 12 keep rules
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:54,243 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:54,246 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_tao0kpik/stage_1_tls_sample_processed.pcap
2025-07-22 17:08:54,246 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:forward - original ranges: 7, after merge: 4, header_only: 2, full_preserve: 2, boundary points: 7
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Flow 0:reverse - original ranges: 5, after merge: 3, header_only: 1, full_preserve: 2, boundary points: 5
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 1 flow directions total
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 8.178.236.80:33492-8.49.51.161:443 -> 0
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=8.178.236.80:33492->8.49.51.161:443
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,247 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,248 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,249 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,250 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,250 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,250 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,250 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,250 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,251 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=reverse
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.49.51.161:443->8.178.236.80:33492, stream_id=0, direction=reverse
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 8.178.236.80:33492->8.49.51.161:443, stream_id=0, direction=forward
2025-07-22 17:08:54,252 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Found matching rule: stream_id=0, direction=forward
2025-07-22 17:08:54,255 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:54,255 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:54,259 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:54,259 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=22, modified_packets=2, execution_time=0.02s, peak_memory=110.3MB, gc_count=0
2025-07-22 17:08:54,259 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=22, modified_packets=2
2025-07-22 17:08:54,260 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:54,260 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=22 packets_modified=2 duration_ms=16.294002532958984 extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.16955898276316175, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/tls_sample.pcap' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap' duration_ms=474.959135055542 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=22, packets_modified=0, duration_ms=6.356954574584961, extra_metrics={'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.006356954574584961, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=22, packets_modified=22, duration_ms=18.00704002380371, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=22, packets_modified=2, duration_ms=16.294002532958984, extra_metrics={'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.16955898276316175, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:54,260 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Duration: 6.356954574584961ms
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 22, 'unique_packets': 22, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 4717, 'output_size': 4717, 'saved_bytes': 0, 'saved_percentage': 0.0}, 'processing_time': 0.006356954574584961, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:54,260 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Modified: 22
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Duration: 18.00704002380371ms
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'file_ip_mappings': {'10.50.50.161': '8.49.51.161', '10.171.250.80': '8.178.236.80'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:54,260 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Processed: 22
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Modified: 2
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Duration: 16.294002532958984ms
2025-07-22 17:08:54,260 - PipelineDebug - INFO -     Extra: {'masked_bytes': 313, 'preserved_bytes': 2584, 'masking_ratio': 0.10804280289955126, 'preservation_ratio': 0.8919571971004487, 'processing_speed_mbps': 0.16955898276316175, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/tls_sample_processed.pcap
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Output size: 4717 bytes
2025-07-22 17:08:54,260 - PipelineDebug - INFO - === DEBUGGING SINGLE FILE: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng ===
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Input: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Output: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Input exists: True
2025-07-22 17:08:54,260 - PipelineDebug - INFO - Input size: 51228 bytes
2025-07-22 17:08:54,260 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Starting deduplication: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:54,261 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng
2025-07-22 17:08:54,262 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Saved 12 unique packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:54,262 - pktmask.core.pipeline.stages.dedup.DeduplicationStage - INFO - Deduplication completed: removed 0/12 duplicate packets (0.0% deduplication rate)
2025-07-22 17:08:54,262 - PipelineDebug - INFO - PROGRESS: Stage DeduplicationStage completed
2025-07-22 17:08:54,262 - PipelineDebug - INFO -   Stats: stage_name='DeduplicationStage' packets_processed=12 packets_modified=0 duration_ms=1.9371509552001953 extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019371509552001953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:54,263 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting IP anonymization: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_0_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:54,263 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Loaded 12 packets from /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_0_http-500error_processed.pcapng
2025-07-22 17:08:54,263 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Analyzing IP addresses and building mapping table...
2025-07-22 17:08:54,263 - pktmask.anonymization.strategy - INFO - Starting directory-level mapping construction - file count: 1
2025-07-22 17:08:54,264 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,264 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,264 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,264 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,264 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,264 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,265 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,265 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,265 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,265 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,265 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,265 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,266 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,266 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,266 - pktmask.adapters.encapsulation_adapter - DEBUG - Extracted 1 IP address pairs for anonymization
2025-07-22 17:08:54,266 - pktmask.ip_anonymization.performance - INFO - Performance: ip_prescan_addresses took 0.002s files_processed=1 unique_ips=2 encapsulated_packets=0 multi_layer_ip_packets=0
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - Frequency statistics completed: unique IPs=2, duration=0.00s
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - Encapsulation processing statistics: total packets=102, encapsulated=0, multi-layer IP=0, normal=102
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - Encapsulation ratio: 0.0%, multi-layer IP ratio: 0.0%
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - Encapsulation type distribution: {'plain': 192}
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - IPv4 A-segment frequency statistics (top 5): {'192': 12, '209': 12}
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - IPv4 A.B-segment frequency statistics (top 5): {'192.168': 12, '209.31': 12}
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - Starting mapping generation - IPv4 addresses: 2, total IPs: 2
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - Hierarchical mapping generation completed: A-segment mappings=2, A.B-segment mappings=2, A.B.C-segment mappings=2
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - Unique segment count statistics: A-segment=2, A.B-segment=4, A.B.C-segment=4
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - All high-frequency network segment mapping consistency validation passed
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - High-frequency A.B-segment consistency validation:
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 192.168 (frequency:12) → 197.184
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - High-frequency segment mapping: 209.31 (frequency:12) → 208.36
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - DEBUG - A-segment mapping examples: {'192': '197', '209': '208'}
2025-07-22 17:08:54,266 - pktmask.ip_anonymization.performance - INFO - Performance: ip_create_mapping took 0.003s total_ips=2 files_processed=1
2025-07-22 17:08:54,266 - pktmask.anonymization.strategy - INFO - IP mapping creation completed: 2 mappings, duration=0.00s
2025-07-22 17:08:54,266 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP mapping construction completed: 2 IP addresses
2025-07-22 17:08:54,266 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Starting packet anonymization
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,267 - pktmask.core.encapsulation.parser - DEBUG - Starting protocol stack parsing
2025-07-22 17:08:54,267 - pktmask.adapters.encapsulation_adapter - DEBUG - IP processing analysis completed: 1 IP layers
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - Saved 12 anonymized packets to /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.ip_anonymization.IPAnonymizationStage - INFO - IP anonymization completed: 2 IPs anonymized, 12/12 packets modified
2025-07-22 17:08:54,270 - PipelineDebug - INFO - PROGRESS: Stage IPAnonymizationStage completed
2025-07-22 17:08:54,270 - PipelineDebug - INFO -   Stats: stage_name='IPAnonymizationStage' packets_processed=12 packets_modified=12 duration_ms=7.15184211730957 extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Starting file processing: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Using dual-module architecture processing mode
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 1: Generate keep rules
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - Starting TLS traffic analysis: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:54,270 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found tshark at: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:54,376 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Detected tshark 4.4.8 at /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:54,376 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analyzer initialization completed, using tshark: /Applications/Wireshark.app/Contents/MacOS/tshark
2025-07-22 17:08:54,376 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Scanning TLS messages
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Merged scan results: 12 reassembled packets, 12 segment packets, 0 after merge
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Found 0 packets containing TLS messages
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzing TCP flows
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Analyzed 0 TCP flows
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating keep rules (using reassembled payload analysis)
2025-07-22 17:08:54,586 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - DEBUG - Generating fallback keep rules (single-packet TLS messages)
2025-07-22 17:08:54,587 - pktmask.core.pipeline.stages.mask_payload_v2.marker.tls_marker.TLSProtocolMarker - INFO - TLS analysis completed, took 0.32 seconds, generated 0 keep rules
2025-07-22 17:08:54,587 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - DEBUG - Phase 2: Apply masking rules
2025-07-22 17:08:54,587 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting mask application: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng -> /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:54,587 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Resetting PayloadMasker processing state
2025-07-22 17:08:54,587 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating input file...
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输入文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_pipeline_ndhj5uvl/stage_1_http-500error_processed.pcapng
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing keep rules...
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Preprocessing completed, 0 flow directions total
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Starting packet-by-packet processing...
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Assigned new flow ID: 197.184.3.113:3541-208.36.26.39:80 -> 0
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Established flow direction info 0: forward=197.184.3.113:3541->208.36.26.39:80
2025-07-22 17:08:54,588 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=forward
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,589 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,590 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 197.184.3.113:3541->208.36.26.39:80, stream_id=0, direction=forward
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Processing packet: 208.36.26.39:80->197.184.3.113:3541, stream_id=0, direction=reverse
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - No matching rule, performing full masking: stream_id=0, direction=reverse
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available streams: []
2025-07-22 17:08:54,591 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - DEBUG - Available directions: {}
2025-07-22 17:08:54,592 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating processing state...
2025-07-22 17:08:54,593 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Validating output file...
2025-07-22 17:08:54,595 - pktmask.core.pipeline.stages.mask_payload_v2.masker.data_validator.DataValidator - DEBUG - 输出文件验证通过: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:54,595 - pktmask.core.pipeline.stages.mask_payload_v2.masker.payload_masker.PayloadMasker - INFO - Mask application completed: processed_packets=12, modified_packets=7, execution_time=0.01s, peak_memory=110.3MB, gc_count=0
2025-07-22 17:08:54,595 - pktmask.core.pipeline.stages.mask_payload_v2.stage.NewMaskPayloadStage - INFO - Dual-module processing completed: processed_packets=12, modified_packets=7
2025-07-22 17:08:54,595 - PipelineDebug - INFO - PROGRESS: Stage NewMaskPayloadStage completed
2025-07-22 17:08:54,595 - PipelineDebug - INFO -   Stats: stage_name='Payload Masking Stage' packets_processed=12 packets_modified=7 duration_ms=7.831811904907227 extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5795001369904715, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Pipeline result: success=True input_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/http-500error.pcapng' output_file='/var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng' duration_ms=334.3391418457031 stage_stats=[StageStats(stage_name='DeduplicationStage', packets_processed=12, packets_modified=0, duration_ms=1.9371509552001953, extra_metrics={'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019371509552001953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}), StageStats(stage_name='IPAnonymizationStage', packets_processed=12, packets_modified=12, duration_ms=7.15184211730957, extra_metrics={'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}), StageStats(stage_name='Payload Masking Stage', packets_processed=12, packets_modified=7, duration_ms=7.831811904907227, extra_metrics={'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5795001369904715, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []})] errors=[]
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Success: True
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Errors: []
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Stage count: 3
2025-07-22 17:08:54,595 - PipelineDebug - INFO -   Stage 0: DeduplicationStage
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Modified: 0
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Duration: 1.9371509552001953ms
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Extra: {'algorithm': 'md5', 'total_packets': 12, 'unique_packets': 12, 'removed_count': 0, 'deduplication_rate': 0.0, 'space_saved': {'input_size': 51228, 'output_size': 5639, 'saved_bytes': 45589, 'saved_percentage': 88.9923479347232}, 'processing_time': 0.0019371509552001953, 'enabled': True, 'stage_name': 'deduplication', 'success': True}
2025-07-22 17:08:54,595 - PipelineDebug - INFO -   Stage 1: IPAnonymizationStage
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Modified: 12
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Duration: 7.15184211730957ms
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Extra: {'method': 'prefix_preserving', 'ipv4_prefix': 24, 'ipv6_prefix': 64, 'original_ips': 2, 'anonymized_ips': 2, 'anonymization_rate': 100.0, 'ip_mappings_count': 2, 'ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'file_ip_mappings': {'192.168.0.113': '197.184.3.113', '209.31.22.39': '208.36.26.39'}, 'enabled': True, 'stage_name': 'ip_anonymization', 'success': True}
2025-07-22 17:08:54,595 - PipelineDebug - INFO -   Stage 2: Payload Masking Stage
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Processed: 12
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Modified: 7
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Duration: 7.831811904907227ms
2025-07-22 17:08:54,595 - PipelineDebug - INFO -     Extra: {'masked_bytes': 4759, 'preserved_bytes': 0, 'masking_ratio': 1.0, 'preservation_ratio': 0.0, 'processing_speed_mbps': 0.5795001369904715, 'protocol': 'tls', 'mode': 'enhanced', 'success': True, 'errors': [], 'warnings': []}
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Output file created: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2/output/http-500error_processed.pcapng
2025-07-22 17:08:54,595 - PipelineDebug - INFO - Output size: 5639 bytes
2025-07-22 17:08:55,600 - PipelineDebug - INFO - 
=== ITERATION ANALYSIS ===
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Iteration 1:
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   tls_sample.pcap: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   http-500error.pcapng: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Iteration 2:
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   tls_sample.pcap: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   http-500error.pcapng: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Iteration 3:
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   tls_sample.pcap: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO -   http-500error.pcapng: Success=True, Stages=3
2025-07-22 17:08:55,601 - PipelineDebug - INFO - 
=== FINAL SUMMARY ===
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Test directory: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Log file: debug_pipeline.log
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Check the log file for detailed execution traces
2025-07-22 17:08:55,601 - PipelineDebug - INFO - Test directory preserved: /var/folders/wz/ql3l9vh10z3c4kt7h9c1ydvh0000gn/T/pktmask_debug_txfuldi2
