# 场景2：范围匹配测试
# 目标：验证对多个连续TLS握手包的范围匹配功能

metadata:
  name: "范围匹配测试"
  description: "验证对TLS握手过程中多个包的范围匹配，包括ClientHello和ServerHello"
  expected_modified_packets: 2
  expected_masked_bytes: 1854  # (517-5) + (1342-5) = 512 + 1337
  expected_kept_bytes: 10      # 5 + 5
  test_type: "range_match"

keep_range_rules:
  # TLS ClientHello包（包4）
  - stream_id: "TCP_10.171.250.80:33492_10.50.50.161:443_forward"
    sequence_start: 2422049782
    sequence_end: 2422050299
    keep_ranges:
      - [0, 5]   # TLS记录头
    protocol_hint: "TLS"
  
  # TLS ServerHello包（包6）
  - stream_id: "TCP_10.171.250.80:33492_10.50.50.161:443_reverse"
    sequence_start: 3913402951
    sequence_end: 3913404293    # 3913402951 + 1342 (载荷长度)
    keep_ranges:
      - [0, 5]   # TLS记录头
    protocol_hint: "TLS"

verification:
  target_packets: [4, 6]  # 包4和包6应该被修改
  unchanged_packets: [1, 2, 3, 5, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]
  modified_payload_check:
    packet_4:
      bytes_0_to_4: "unchanged"  # TLS记录头保持不变
      bytes_5_to_516: "masked"   # 握手数据被掩码
    packet_6:
      bytes_0_to_4: "unchanged"  # TLS记录头保持不变
      bytes_5_to_1341: "masked"  # 握手数据被掩码 