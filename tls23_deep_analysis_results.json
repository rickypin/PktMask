{
  "tshark_raw_analysis": {
    "total_tls_packets": 10,
    "tls23_packets_count": 2,
    "tls23_packets": [
      {
        "frame": "14",
        "tcp_stream": "0",
        "tcp_seq": "2422050425",
        "tcp_len": "205",
        "tls_content_types": [
          "23",
          "23"
        ],
        "tls_record_lengths": [
          "169",
          "26"
        ]
      },
      {
        "frame": "15",
        "tcp_stream": "0",
        "tcp_seq": "3913404815",
        "tcp_len": "111",
        "tls_content_types": [
          "23"
        ],
        "tls_record_lengths": [
          "106"
        ]
      }
    ],
    "all_packets": [
      {
        "frame": "4",
        "tcp_stream": "0",
        "tcp_seq": "2422049782",
        "tcp_len": "517",
        "tls_content_types": [
          "22"
        ],
        "tls_record_lengths": [
          "512"
        ]
      },
      {
        "frame": "6",
        "tcp_stream": "0",
        "tcp_seq": "3913402951",
        "tcp_len": "1342",
        "tls_content_types": [],
        "tls_record_lengths": []
      },
      {
        "frame": "7",
        "tcp_stream": "0",
        "tcp_seq": "3913404293",
        "tcp_len": "471",
        "tls_content_types": [
          "22"
        ],
        "tls_record_lengths": [
          "1808"
        ]
      },
      {
        "frame": "9",
        "tcp_stream": "0",
        "tcp_seq": "2422050299",
        "tcp_len": "126",
        "tls_content_types": [
          "22",
          "20",
          "22"
        ],
        "tls_record_lengths": [
          "70",
          "1",
          "40"
        ]
      },
      {
        "frame": "10",
        "tcp_stream": "0",
        "tcp_seq": "3913404764",
        "tcp_len": "6",
        "tls_content_types": [
          "20"
        ],
        "tls_record_lengths": [
          "1"
        ]
      },
      {
        "frame": "12",
        "tcp_stream": "0",
        "tcp_seq": "3913404770",
        "tcp_len": "45",
        "tls_content_types": [
          "22"
        ],
        "tls_record_lengths": [
          "40"
        ]
      },
      {
        "frame": "14",
        "tcp_stream": "0",
        "tcp_seq": "2422050425",
        "tcp_len": "205",
        "tls_content_types": [
          "23",
          "23"
        ],
        "tls_record_lengths": [
          "169",
          "26"
        ]
      },
      {
        "frame": "15",
        "tcp_stream": "0",
        "tcp_seq": "3913404815",
        "tcp_len": "111",
        "tls_content_types": [
          "23"
        ],
        "tls_record_lengths": [
          "106"
        ]
      },
      {
        "frame": "16",
        "tcp_stream": "0",
        "tcp_seq": "2422050630",
        "tcp_len": "31",
        "tls_content_types": [
          "21"
        ],
        "tls_record_lengths": [
          "26"
        ]
      },
      {
        "frame": "19",
        "tcp_stream": "0",
        "tcp_seq": "3913404926",
        "tcp_len": "31",
        "tls_content_types": [
          "21"
        ],
        "tls_record_lengths": [
          "26"
        ]
      }
    ]
  },
  "marker_processing_trace": {
    "config_used": {
      "preserve": {
        "handshake": true,
        "application_data": false,
        "alert": true,
        "change_cipher_spec": true,
        "heartbeat": true
      }
    },
    "total_rules": 6,
    "tls23_rules_count": 2,
    "tls23_rules": [
      {
        "rule_type": "tls_applicationdata_header",
        "seq_range": "2422050425-2422050430",
        "length": 5,
        "metadata": {
          "tls_content_type": 23,
          "tls_type_name": "ApplicationData",
          "frame_number": "14",
          "tcp_seq_raw": 2422050425,
          "preserve_reason": "tls_record_header",
          "header_size": 5,
          "preserve_strategy": "header_only"
        }
      },
      {
        "rule_type": "tls_applicationdata_header",
        "seq_range": "3913404815-3913404820",
        "length": 5,
        "metadata": {
          "tls_content_type": 23,
          "tls_type_name": "ApplicationData",
          "frame_number": "15",
          "tcp_seq_raw": 3913404815,
          "preserve_reason": "tls_record_header",
          "header_size": 5,
          "preserve_strategy": "header_only"
        }
      }
    ],
    "all_rules": [
      {
        "rule_type": "tls_handshake+tls_handshake",
        "seq_range": "2422049782-2422050425",
        "length": 643,
        "metadata": {
          "tls_content_type": 22,
          "tls_type_name": "Handshake",
          "frame_number": "9",
          "tcp_seq_raw": 2422050299,
          "tcp_len": 126,
          "merged_from": [
            "unknown",
            "unknown"
          ]
        }
      },
      {
        "rule_type": "tls_applicationdata_header",
        "seq_range": "2422050425-2422050430",
        "length": 5,
        "metadata": {
          "tls_content_type": 23,
          "tls_type_name": "ApplicationData",
          "frame_number": "14",
          "tcp_seq_raw": 2422050425,
          "preserve_reason": "tls_record_header",
          "header_size": 5,
          "preserve_strategy": "header_only"
        }
      },
      {
        "rule_type": "tls_alert",
        "seq_range": "2422050630-2422050661",
        "length": 31,
        "metadata": {
          "tls_content_type": 21,
          "tls_type_name": "Alert",
          "frame_number": "16",
          "tcp_seq_raw": 2422050630,
          "tcp_len": 31
        }
      },
      {
        "rule_type": "tls_handshake+tls_handshake+tls_changecipherspec+tls_handshake",
        "seq_range": "3913402951-3913404815",
        "length": 1864,
        "metadata": {
          "tls_content_type": 22,
          "tls_type_name": "Handshake",
          "frame_number": "12",
          "tcp_seq_raw": 3913404770,
          "tcp_len": 45,
          "merged_from": [
            "unknown",
            "unknown"
          ]
        }
      },
      {
        "rule_type": "tls_applicationdata_header",
        "seq_range": "3913404815-3913404820",
        "length": 5,
        "metadata": {
          "tls_content_type": 23,
          "tls_type_name": "ApplicationData",
          "frame_number": "15",
          "tcp_seq_raw": 3913404815,
          "preserve_reason": "tls_record_header",
          "header_size": 5,
          "preserve_strategy": "header_only"
        }
      },
      {
        "rule_type": "tls_alert",
        "seq_range": "3913404926-3913404957",
        "length": 31,
        "metadata": {
          "tls_content_type": 21,
          "tls_type_name": "Alert",
          "frame_number": "19",
          "tcp_seq_raw": 3913404926,
          "tcp_len": 31
        }
      }
    ]
  },
  "configuration_analysis": {
    "config_tests": [
      {
        "config_name": "当前配置(application_data=False)",
        "application_data_setting": false,
        "tls23_rules_generated": 2,
        "total_rules": 6
      },
      {
        "config_name": "测试配置(application_data=True)",
        "application_data_setting": true,
        "tls23_rules_generated": 2,
        "total_rules": 2
      }
    ]
  },
  "root_cause_analysis": {
    "potential_causes": [
      {
        "cause": "TLS-23消息识别失败",
        "description": "Marker模块未能正确识别TLS-23消息",
        "verification": "检查tshark输出是否包含TLS-23消息"
      },
      {
        "cause": "配置逻辑错误",
        "description": "application_data=False时应生成头部保留规则，但实际未生成任何规则",
        "verification": "检查_should_preserve_tls_type方法的逻辑"
      },
      {
        "cause": "规则生成逻辑缺陷",
        "description": "即使识别了TLS-23消息，也未正确生成头部保留规则",
        "verification": "检查_generate_keep_rules方法中的TLS-23处理逻辑"
      },
      {
        "cause": "TLS-23头部长度计算错误",
        "description": "未正确计算TLS记录头部的5字节长度",
        "verification": "检查是否有专门的头部长度计算逻辑"
      }
    ],
    "most_likely_cause": {
      "primary_cause": "配置逻辑错误",
      "explanation": "当application_data=False时，代码逻辑可能直接跳过了TLS-23消息的处理，而没有实现'保留头部，掩码载荷'的预期行为",
      "fix_strategy": "修改TLS Marker中的_should_preserve_tls_type和规则生成逻辑，使application_data=False时生成5字节头部保留规则"
    }
  }
}