# Phase 5: 验收测试详细计划

**测试目标**: 全面验证简化重构后的PktMask系统  
**测试范围**: 功能完整性 + 性能基准 + 可扩展性验证  
**期望成果**: 确保100%功能保持，性能达标，可扩展性验证通过  

---

## 📋 **总体测试策略**

### **测试优先级**
1. **🔴 P0 - 关键功能**: 核心处理功能必须100%工作
2. **🟡 P1 - 重要功能**: GUI交互、配置管理必须正常
3. **🟢 P2 - 扩展功能**: 可扩展性、开发者体验

### **通过标准**
- **功能测试**: 100%通过，无功能回归
- **性能测试**: 速度≥90%，内存≤80%，启动≤50%
- **扩展测试**: 新增处理器≤1天工作量

---

## 🔍 **检查点 5.1: 功能完整性验证**

### **5.1.1 核心处理功能测试** 🔴 P0

**测试内容**:
- [ ] **IP匿名化功能**
  - [ ] 单独使用IP匿名化 ✓ 输出与原系统100%一致
  - [ ] 层次化匿名策略正确应用
  - [ ] 子网结构保持选项正常工作
  - [ ] 错误文件处理和恢复

- [ ] **去重功能**  
  - [ ] 单独使用去重功能 ✓ 去重效果与原系统一致
  - [ ] 统计数据正确输出（去重前后数量）
  - [ ] 内存使用合理（大文件测试）
  - [ ] 边界情况处理（空文件、单包文件）

- [ ] **裁切功能**
  - [ ] 单独使用裁切功能 ✓ 裁切效果与原系统一致  
  - [ ] TLS握手保留功能正常
  - [ ] 载荷裁切长度设置正确
  - [ ] 协议识别和处理正确

**测试数据**:
```
tests/data/TC-001-1-20160407/  (小型HTTP流量)
tests/data/TC-002-5-20220215/  (中型HTTPS流量)  
tests/data/TC-002-8-20210817/  (大型混合流量)
tests/data/big/                (超大文件>500MB)
```

### **5.1.2 组合处理功能测试** 🔴 P0

**测试内容**:
- [ ] **两两组合** (3选2，共3种组合)
  - [ ] IP匿名化 + 去重
  - [ ] IP匿名化 + 裁切  
  - [ ] 去重 + 裁切

- [ ] **全部组合** (3选3，1种组合)
  - [ ] IP匿名化 + 去重 + 裁切
  - [ ] 处理顺序正确性验证
  - [ ] 中间结果一致性检查

**验证标准**:
```bash
# 对比工具输出验证
diff original_output.pcap new_output.pcap  # 应该相同
compare_stats original_stats.json new_stats.json  # 统计一致
```

### **5.1.3 GUI交互功能测试** 🟡 P1

**测试内容**:
- [ ] **复选框交互** (已在Phase 3验证，重新确认)
  - [ ] 8种组合状态切换正常
  - [ ] 开始按钮启用/禁用逻辑正确
  - [ ] 状态保存和恢复功能

- [ ] **文件操作**
  - [ ] 文件选择对话框正常
  - [ ] 支持.pcap和.pcapng格式
  - [ ] 输出目录选择正常
  - [ ] 文件权限检查和提示

- [ ] **进度显示**
  - [ ] 进度条更新准确
  - [ ] 处理状态信息显示
  - [ ] 取消操作功能正常
  - [ ] 错误提示和恢复机制

### **5.1.4 配置系统测试** 🟡 P1

**测试内容**:
- [ ] **配置加载**
  - [ ] YAML格式配置文件加载
  - [ ] JSON格式配置文件加载
  - [ ] 默认配置生成
  - [ ] 配置验证和错误处理

- [ ] **配置保存**
  - [ ] 设置更改后保存
  - [ ] 配置文件格式正确
  - [ ] 配置值准确性验证

- [ ] **向后兼容性**
  - [ ] 旧版本配置文件可正常加载
  - [ ] 配置迁移功能正常
  - [ ] 缺失配置项用默认值补充

---

## 📊 **检查点 5.2: 性能基准测试**

### **5.2.1 处理速度测试** 🔴 P0

**测试环境**:
```
硬件: macOS系统，内存≥8GB
Python: 3.8+
测试文件: 标准测试数据集
```

**测试项目**:
- [ ] **小文件处理速度** (<10MB)
  - [ ] 基准: 原系统处理时间 = _____ 秒
  - [ ] 新系统: 处理时间 = _____ 秒  
  - [ ] 性能比例: _____ % (目标≥90%)

- [ ] **中等文件处理速度** (10-100MB)
  - [ ] 基准: 原系统处理时间 = _____ 秒
  - [ ] 新系统: 处理时间 = _____ 秒
  - [ ] 性能比例: _____ % (目标≥90%)

- [ ] **大文件处理速度** (>100MB)
  - [ ] 基准: 原系统处理时间 = _____ 秒  
  - [ ] 新系统: 处理时间 = _____ 秒
  - [ ] 性能比例: _____ % (目标≥90%)

### **5.2.2 内存使用测试** 🟡 P1

**测试项目**:
- [ ] **内存峰值测试**
  - [ ] 基准: 原系统内存峰值 = _____ MB
  - [ ] 新系统: 内存峰值 = _____ MB
  - [ ] 内存比例: _____ % (目标≤80%)

- [ ] **内存泄漏测试**
  - [ ] 连续处理10个文件无内存泄漏
  - [ ] 长时间运行稳定性测试
  - [ ] 大文件处理后内存释放正常

### **5.2.3 启动时间测试** 🟡 P1

**测试项目**:
- [ ] **应用启动时间**
  - [ ] 基准: 原系统启动时间 = _____ 秒
  - [ ] 新系统: 启动时间 = _____ 秒  
  - [ ] 时间比例: _____ % (目标≤50%)

- [ ] **模块加载时间**
  - [ ] 处理器模块加载 < 1秒
  - [ ] 配置系统加载 < 0.5秒
  - [ ] GUI界面显示 < 2秒

---

## 🔧 **检查点 5.3: 可扩展性验证**

### **5.3.1 新增处理器测试** 🟢 P2

**目标**: 验证添加新处理器的简易性

**测试计划**:
- [ ] **创建示例处理器** - "Web-Focused Processor"
  ```python
  class WebFocusedProcessor(BaseProcessor):
      def process_file(self, input_path: str, output_path: str) -> ProcessorResult:
          # 只保留HTTP/HTTPS流量
          pass
      
      def get_display_name(self) -> str:
          return "Web-Focused Traffic"
  ```

- [ ] **集成到系统**
  - [ ] 注册到ProcessorRegistry
  - [ ] 添加配置支持 
  - [ ] GUI集成（如果有相关复选框）
  - [ ] 编写单元测试

- [ ] **工作量统计**
  - [ ] 实际工作时间: _____ 小时（目标≤8小时）
  - [ ] 需要修改的文件数量: _____ 个
  - [ ] 是否需要修改核心架构: 是/否

### **5.3.2 架构稳定性验证** 🟢 P2

**测试项目**:
- [ ] **注册机制测试**
  - [ ] 动态注册新处理器
  - [ ] 处理器发现机制正常
  - [ ] 重复注册错误处理

- [ ] **配置扩展测试**  
  - [ ] 新处理器配置项添加
  - [ ] 配置验证机制扩展
  - [ ] 默认值设置和加载

- [ ] **错误处理测试**
  - [ ] 处理器异常捕获和报告
  - [ ] 失败处理器的隔离
  - [ ] 系统恢复和继续处理

---

## 📋 **测试执行计划**

### **第1天: 功能完整性测试**
- 上午: 核心处理功能测试 (5.1.1-5.1.2)
- 下午: GUI和配置系统测试 (5.1.3-5.1.4)
- 输出: 功能测试报告

### **第2天: 性能基准测试**  
- 上午: 处理速度和内存测试 (5.2.1-5.2.2)
- 下午: 启动时间和稳定性测试 (5.2.3)
- 输出: 性能基准报告

### **第3天: 可扩展性验证**
- 上午: 新增处理器实现 (5.3.1)
- 下午: 架构稳定性测试 (5.3.2)
- 输出: 可扩展性验证报告

### **第4天: 综合验收和文档**
- 上午: 全面回归测试
- 下午: 文档更新和发布准备
- 输出: 最终验收报告

---

## 📊 **测试工具和脚本**

### **自动化测试脚本**
```bash
# 功能完整性测试
python test_phase_5_functionality.py

# 性能基准测试  
python test_phase_5_performance.py

# 可扩展性测试
python test_phase_5_extensibility.py

# 综合测试套件
python test_phase_5_complete.py
```

### **性能监控工具**
```bash
# 内存监控
python -m memory_profiler run_gui.py

# 处理时间监控
python -m cProfile -o profile_stats.prof run_processing.py

# 系统资源监控
htop / Activity Monitor
```

### **结果对比工具**
```bash
# 文件内容对比
diff -r original_output/ new_output/

# 统计数据对比
python compare_processing_stats.py

# 性能数据对比
python compare_performance_metrics.py
```

---

## ✅ **验收标准总结**

### **必须通过的标准**
- [ ] **功能测试**: 100%通过，无功能回归
- [ ] **性能测试**: 速度≥90%，内存≤80%，启动≤50%  
- [ ] **扩展测试**: 新增处理器≤1天（8小时）
- [ ] **质量标准**: 测试覆盖率≥80%，无严重bug

### **可选通过的标准**  
- [ ] **超越性能**: 速度≥95%，内存≤70%，启动≤30%
- [ ] **扩展便利**: 新增处理器≤4小时
- [ ] **代码质量**: 测试覆盖率≥90%，静态分析满分

### **最终交付物**
- [ ] **Phase 5验收测试报告**
- [ ] **性能基准对比报告**
- [ ] **可扩展性验证文档**
- [ ] **更新的技术文档**
- [ ] **用户接受度调查结果**

---

**测试计划版本**: 1.0  
**创建日期**: 2024年12月  
**预计执行时间**: 4个工作日  
**负责人**: 开发团队 + QA团队 